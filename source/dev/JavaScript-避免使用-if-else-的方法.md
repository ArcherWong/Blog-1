---
layout: post
title: JavaScript 避免使用 if-else 的方法
date: 2019-01-15 10:47:30
tags: [JavaScript, 教程]
---

# JavaScript 避免使用 if-else 的方法

## 场景

在日常编写 JavaScript 代码的过程中，或许会遇到一个很常见的问题。根据某个状态，进行判断，并执行不同的操作。
例如下面这段代码，点击不同的按钮，切换不同的状态，并显示不同的面板。

那么，我们可以如何优化呢？

## 抽取函数

稍有些经验的 developer 都知道，如果一个函数过于冗长，那么就应该将之分离成多个单独的函数。

所以，我们的代码变成了下面这样

实现思路

1. 抽取每个状态对应执行的函数
2. 根据状态使用 `if-else/switch` 判断然后调用不同的函数

```js
```

## Map 映射

如果我们不想使用 if else 进行各种判断，那么 `Map<Number, Function>` 或许是一个更好的选择。

实现思路

1. 创建一个 `Map<Number, Function>` `statusFnMap`，用以保存状态与执行函数的对应关系
2. 向 `statusFnMap` 添加状态与对应的函数
3. 调用者根据状态去获取到对应的函数并执行

具体实现

```js
```

主要优势

- 如果是一些比较简单的状态处理可以尝试使用这种方式，毕竟实现起来比较简单

## ES6 class：有限状态机

如果你知道 ES6 的 `class` 的话，应该也了解到目前 js 可以使用 `class` 模拟面向对象的继承，以及多态。

实现思路

1. 创建一个基类，并在其中声明一个需要被子类重写的方法
2. 根据不同的状态创建不同的子类，并分别实现基类的方法
3. 添加一个 `Builder` 类，用于根据不同的状态判断来创建不同的子类
4. 调用者使用 `Builder` 类构造出来的对象调用父类中声明的方法

具体实现

```js
```

主要优势

- 分离了状态与执行函数之间的关联，具体执行由具体的子类决定
- 子类允许包含独有的属性/方法
- 可扩展性更好，随时可以扩展任意多个子类

## ES6 class：无限状态机

上面使用 class 继承多态实现的状态机虽然很好，但却并不能应对 **不确定** 具体有多少种状态的情况。因为每个子类都与父类有着强关联，直接在父类中进行了声明。那么，有没有一种方式，可以让父类 **自动** 找到所有的子类呢？

1. 创建一个基类，并在其中声明一个需要被子类重写的方法
2. 根据不同的状态创建不同的子类，并分别实现基类的方法
3. 添加一个 `Builder` 类，使用反射拿到所有的子类，具体子类对应的状态由子类的某个属性决定
4. 使用 `Builder` 构造子类对象，并调用基类声明的方法

具体实现

```js
```

主要优势

- 虽然再次将状态与执行函数分离开来，然而内聚也是一种良好的状态
- 可扩展性最好，添加新的子类不影响父类及其他子类
